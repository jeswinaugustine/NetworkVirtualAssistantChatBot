
Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on a network, taking into account the unique characteristics of each traffic type and its importance within an organization's infrastructure.
QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.

End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

Best Effort Service
Ethernet Class of Service (CoS)


Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5


page: 5
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 6
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7


page: 7
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 8
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9


page: 9
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 10
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11


page: 11
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 12
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13


page: 13
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 14
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15


page: 15
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 16
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17


page: 17
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 18
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19


page: 19
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 20
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21


page: 21
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 22
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23


page: 23
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 24
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25


page: 25
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 26
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27


page: 27
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 28
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29


page: 29
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 30
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31


page: 31
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 32
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33


page: 33
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 34
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35


page: 35
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 36
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 4
Websites

Networking Websites
Hewlett Packard Enterprise Networking Information Library

www.hpe.com/networking/resourcefinder

Hewlett Packard Enterprise Networking Software

www.hpe.com/networking/software

Hewlett Packard Enterprise Networking website

www.hpe.com/info/networking

Hewlett Packard Enterprise My Networking website

www.hpe.com/networking/support

Hewlett Packard Enterprise My Networking Portal

www.hpe.com/networking/mynetworking

Hewlett Packard Enterprise Networking Warranty

www.hpe.com/networking/warranty

General websites
Hewlett Packard Enterprise Information Library

www.hpe.com/info/EIL

For additional websites, see Support and other resources.

Chapter 4 Websites

37


page: 37
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 4
Websites

Networking Websites
Hewlett Packard Enterprise Networking Information Library

www.hpe.com/networking/resourcefinder

Hewlett Packard Enterprise Networking Software

www.hpe.com/networking/software

Hewlett Packard Enterprise Networking website

www.hpe.com/info/networking

Hewlett Packard Enterprise My Networking website

www.hpe.com/networking/support

Hewlett Packard Enterprise My Networking Portal

www.hpe.com/networking/mynetworking

Hewlett Packard Enterprise Networking Warranty

www.hpe.com/networking/warranty

General websites
Hewlett Packard Enterprise Information Library

www.hpe.com/info/EIL

For additional websites, see Support and other resources.

Chapter 4 Websites

37

Chapter 5
Support and other resources

Accessing Hewlett Packard Enterprise Support
• For live assistance, go to the Contact Hewlett Packard Enterprise Worldwide website:

http://www.hpe.com/assistance

• To access documentation and support services, go to the Hewlett Packard Enterprise Support Center website:

http://www.hpe.com/support/hpesc

Information to collect

• Technical support registration number (if applicable)
• Product name, model or version, and serial number
• Operating system name and version
• Firmware version
• Error messages
• Product-specific reports and logs
• Add-on products or components
• Third-party products or components

Accessing updates
• Some software products provide a mechanism for accessing software updates through the product interface.

Review your product documentation to identify the recommended software update method.

• To download product updates:

Hewlett Packard Enterprise Support Center

www.hpe.com/support/hpesc

Hewlett Packard Enterprise Support Center: Software downloads

www.hpe.com/support/downloads

Software Depot

www.hpe.com/support/softwaredepot

• To subscribe to eNewsletters and alerts:

www.hpe.com/support/e-updates

• To view and update your entitlements, and to link your contracts and warranties with your profile, go to the

Hewlett Packard Enterprise Support Center More Information on Access to Support Materials page:

38

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


page: 38
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 4
Websites

Networking Websites
Hewlett Packard Enterprise Networking Information Library

www.hpe.com/networking/resourcefinder

Hewlett Packard Enterprise Networking Software

www.hpe.com/networking/software

Hewlett Packard Enterprise Networking website

www.hpe.com/info/networking

Hewlett Packard Enterprise My Networking website

www.hpe.com/networking/support

Hewlett Packard Enterprise My Networking Portal

www.hpe.com/networking/mynetworking

Hewlett Packard Enterprise Networking Warranty

www.hpe.com/networking/warranty

General websites
Hewlett Packard Enterprise Information Library

www.hpe.com/info/EIL

For additional websites, see Support and other resources.

Chapter 4 Websites

37

Chapter 5
Support and other resources

Accessing Hewlett Packard Enterprise Support
• For live assistance, go to the Contact Hewlett Packard Enterprise Worldwide website:

http://www.hpe.com/assistance

• To access documentation and support services, go to the Hewlett Packard Enterprise Support Center website:

http://www.hpe.com/support/hpesc

Information to collect

• Technical support registration number (if applicable)
• Product name, model or version, and serial number
• Operating system name and version
• Firmware version
• Error messages
• Product-specific reports and logs
• Add-on products or components
• Third-party products or components

Accessing updates
• Some software products provide a mechanism for accessing software updates through the product interface.

Review your product documentation to identify the recommended software update method.

• To download product updates:

Hewlett Packard Enterprise Support Center

www.hpe.com/support/hpesc

Hewlett Packard Enterprise Support Center: Software downloads

www.hpe.com/support/downloads

Software Depot

www.hpe.com/support/softwaredepot

• To subscribe to eNewsletters and alerts:

www.hpe.com/support/e-updates

• To view and update your entitlements, and to link your contracts and warranties with your profile, go to the

Hewlett Packard Enterprise Support Center More Information on Access to Support Materials page:

38

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

www.hpe.com/support/AccessToSupportMaterials

Access to some updates might require product entitlement when accessed through the Hewlett
Packard Enterprise Support Center. You must have an HPE Passport set up with relevant
entitlements.

Customer self repair
Hewlett Packard Enterprise customer self repair (CSR) programs allow you to repair your product. If a CSR part
needs to be replaced, it will be shipped directly to you so that you can install it at your convenience. Some parts
do not qualify for CSR. Your Hewlett Packard Enterprise authorized service provider will determine whether a
repair can be accomplished by CSR.
For more information about CSR, contact your local service provider or go to the CSR website:
http://www.hpe.com/support/selfrepair
Remote support
Remote support is available with supported devices as part of your warranty or contractual support agreement. It
provides intelligent event diagnosis, and automatic, secure submission of hardware event notifications to Hewlett
Packard Enterprise, which will initiate a fast and accurate resolution based on your product's service level.
Hewlett Packard Enterprise strongly recommends that you register your device for remote support.
If your product includes additional remote support details, use search to locate that information.

Remote support and Proactive Care information
HPE Get Connected

www.hpe.com/services/getconnected

HPE Proactive Care services

www.hpe.com/services/proactivecare

HPE Proactive Care service: Supported products list

www.hpe.com/services/proactivecaresupportedproducts

HPE Proactive Care advanced service: Supported products list

www.hpe.com/services/proactivecareadvancedsupportedproducts

Proactive Care customer information
Proactive Care central

www.hpe.com/services/proactivecarecentral

Proactive Care service activation

www.hpe.com/services/proactivecarecentralgetstarted

Warranty information
To view the warranty for your product or to view the Safety and Compliance Information for Server, Storage,
Power, Networking, and Rack Products reference document, go to the Enterprise Safety and Compliance website:
www.hpe.com/support/Safety-Compliance-EnterpriseProducts

Additional warranty information
HPE ProLiant and x86 Servers and Options

www.hpe.com/support/ProLiantServers-Warranties

Chapter 5 Support and other resources

39


page: 39
Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 4
Websites

Networking Websites
Hewlett Packard Enterprise Networking Information Library

www.hpe.com/networking/resourcefinder

Hewlett Packard Enterprise Networking Software

www.hpe.com/networking/software

Hewlett Packard Enterprise Networking website

www.hpe.com/info/networking

Hewlett Packard Enterprise My Networking website

www.hpe.com/networking/support

Hewlett Packard Enterprise My Networking Portal

www.hpe.com/networking/mynetworking

Hewlett Packard Enterprise Networking Warranty

www.hpe.com/networking/warranty

General websites
Hewlett Packard Enterprise Information Library

www.hpe.com/info/EIL

For additional websites, see Support and other resources.

Chapter 4 Websites

37

Chapter 5
Support and other resources

Accessing Hewlett Packard Enterprise Support
• For live assistance, go to the Contact Hewlett Packard Enterprise Worldwide website:

http://www.hpe.com/assistance

• To access documentation and support services, go to the Hewlett Packard Enterprise Support Center website:

http://www.hpe.com/support/hpesc

Information to collect

• Technical support registration number (if applicable)
• Product name, model or version, and serial number
• Operating system name and version
• Firmware version
• Error messages
• Product-specific reports and logs
• Add-on products or components
• Third-party products or components

Accessing updates
• Some software products provide a mechanism for accessing software updates through the product interface.

Review your product documentation to identify the recommended software update method.

• To download product updates:

Hewlett Packard Enterprise Support Center

www.hpe.com/support/hpesc

Hewlett Packard Enterprise Support Center: Software downloads

www.hpe.com/support/downloads

Software Depot

www.hpe.com/support/softwaredepot

• To subscribe to eNewsletters and alerts:

www.hpe.com/support/e-updates

• To view and update your entitlements, and to link your contracts and warranties with your profile, go to the

Hewlett Packard Enterprise Support Center More Information on Access to Support Materials page:

38

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

www.hpe.com/support/AccessToSupportMaterials

Access to some updates might require product entitlement when accessed through the Hewlett
Packard Enterprise Support Center. You must have an HPE Passport set up with relevant
entitlements.

Customer self repair
Hewlett Packard Enterprise customer self repair (CSR) programs allow you to repair your product. If a CSR part
needs to be replaced, it will be shipped directly to you so that you can install it at your convenience. Some parts
do not qualify for CSR. Your Hewlett Packard Enterprise authorized service provider will determine whether a
repair can be accomplished by CSR.
For more information about CSR, contact your local service provider or go to the CSR website:
http://www.hpe.com/support/selfrepair
Remote support
Remote support is available with supported devices as part of your warranty or contractual support agreement. It
provides intelligent event diagnosis, and automatic, secure submission of hardware event notifications to Hewlett
Packard Enterprise, which will initiate a fast and accurate resolution based on your product's service level.
Hewlett Packard Enterprise strongly recommends that you register your device for remote support.
If your product includes additional remote support details, use search to locate that information.

Remote support and Proactive Care information
HPE Get Connected

www.hpe.com/services/getconnected

HPE Proactive Care services

www.hpe.com/services/proactivecare

HPE Proactive Care service: Supported products list

www.hpe.com/services/proactivecaresupportedproducts

HPE Proactive Care advanced service: Supported products list

www.hpe.com/services/proactivecareadvancedsupportedproducts

Proactive Care customer information
Proactive Care central

www.hpe.com/services/proactivecarecentral

Proactive Care service activation

www.hpe.com/services/proactivecarecentralgetstarted

Warranty information
To view the warranty for your product or to view the Safety and Compliance Information for Server, Storage,
Power, Networking, and Rack Products reference document, go to the Enterprise Safety and Compliance website:
www.hpe.com/support/Safety-Compliance-EnterpriseProducts

Additional warranty information
HPE ProLiant and x86 Servers and Options

www.hpe.com/support/ProLiantServers-Warranties

Chapter 5 Support and other resources

39

HPE Enterprise Servers

www.hpe.com/support/EnterpriseServers-Warranties

HPE Storage Products

www.hpe.com/support/Storage-Warranties

HPE Networking Products

www.hpe.com/support/Networking-Warranties

Regulatory information
To view the regulatory information for your product, view the Safety and Compliance Information for Server,
Storage, Power, Networking, and Rack Products, available at the Hewlett Packard Enterprise Support Center:
www.hpe.com/support/Safety-Compliance-EnterpriseProducts

Additional regulatory information
Hewlett Packard Enterprise is committed to providing our customers with information about the chemical
substances in our products as needed to comply with legal requirements such as REACH (Regulation EC No
1907/2006 of the European Parliament and the Council). A chemical information report for this product can be
found at:
www.hpe.com/info/reach
For Hewlett Packard Enterprise product environmental and safety information and compliance data, including
RoHS and REACH, see:
www.hpe.com/info/ecodata
For Hewlett Packard Enterprise environmental information, including company programs, product recycling, and
energy efficiency, see:
www.hpe.com/info/environment
Documentation feedback
Hewlett Packard Enterprise is committed to providing documentation that meets your needs. To help us improve
the documentation, send any errors, suggestions, or comments to Documentation Feedback
(docsfeedback@hpe.com). When submitting your feedback, include the document title, part number, edition,
and publication date located on the front cover of the document. For online help content, include the product
name, product version, help edition, and publication date located on the legal notices page.

40

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


Aruba 8400 Quality of Service Guide for
ArubaOS-CX 10.00

Part Number: 5200-4338a
Published: April 2018
Edition: 2

© Copyright 2018 Hewlett Packard Enterprise Development LP

Notices

The information contained herein is subject to change without notice. The only warranties for Hewlett Packard
Enterprise products and services are set forth in the express warranty statements accompanying such products
and services. Nothing herein should be construed as constituting an additional warranty. Hewlett Packard
Enterprise shall not be liable for technical or editorial errors or omissions contained herein.
Confidential computer software. Valid license from Hewlett Packard Enterprise required for possession, use, or
copying. Consistent with FAR 12.211 and 12.212, Commercial Computer Software, Computer Software
Documentation, and Technical Data for Commercial Items are licensed to the U.S. Government under vendor's
standard commercial license.
Links to third-party websites take you outside the Hewlett Packard Enterprise website. Hewlett Packard Enterprise
has no control over and is not responsible for information outside the Hewlett Packard Enterprise website.

Acknowledgments

Intel®, Itanium®, Pentium®, Intel Inside®, and the Intel Inside logo are trademarks of Intel Corporation in the United
States and other countries.
Microsoft® and Windows® are either registered trademarks or trademarks of Microsoft Corporation in the United
States and/or other countries.
Adobe® and Acrobat® are trademarks of Adobe Systems Incorporated.
Java® and Oracle® are registered trademarks of Oracle and/or its affiliates.
UNIX® is a registered trademark of The Open Group.

Contents

Chapter 1 QoS overview ................................................................................. 5
End-to-end QoS behavior.......................................................................................................................... 5
QoS on the switch......................................................................................................................................7
QoS trust.........................................................................................................................................8
CoS map.............................................................................................................................. 9
DSCP map......................................................................................................................... 10
Queue profile.................................................................................................................................11
Schedule profiles...........................................................................................................................11
Strict priority queuing..........................................................................................................12
Weighted fair queuing.........................................................................................................12
Strict priority plus weighted fair queuing.............................................................................12
Port rate limiting............................................................................................................................ 12
Virtual output queues.................................................................................................................... 13
Terms............................................................................................................................................ 13

Chapter 2 QoS configuration ....................................................................... 15
Configuring QoS...................................................................................................................................... 15
Configuring expedited forwarding for VoIP traffic.....................................................................................16
Configuring rate limiting........................................................................................................................... 17
Monitoring queue operation..................................................................................................................... 18

Chapter 3 QoS commands ........................................................................... 19
apply qos..............................................................................................................................................19
name queue........................................................................................................................................... 20
map queue..............................................................................................................................................21
qos cos-map......................................................................................................................................... 21
qos dscp-map....................................................................................................................................... 22
qos queue-profile............................................................................................................................ 24
qos schedule-profile......................................................................................................................24
qos trust..............................................................................................................................................26
rate-limit........................................................................................................................................... 27
show interface...................................................................................................................................28
show qos cos-map...............................................................................................................................30
show qos dscp-map............................................................................................................................ 31
show qos queue-profile..................................................................................................................32
show qos schedule-profile........................................................................................................... 33
show qos trust...................................................................................................................................34
strict queue....................................................................................................................................... 34
wfq queue..............................................................................................................................................35

Chapter 4 Websites........................................................................................ 37

Chapter 5 Support and other resources...................................................... 38
Accessing Hewlett Packard Enterprise Support...................................................................................... 38
Accessing updates...................................................................................................................................38

Contents

3

Customer self repair.................................................................................................................................39
Remote support....................................................................................................................................... 39
Warranty information................................................................................................................................39
Regulatory information.............................................................................................................................40
Documentation feedback......................................................................................................................... 40

4

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 1
QoS overview

Quality of Service (QoS) enables network administrators to customize how different types of traffic are serviced on
a network, taking into account the unique characteristics of each traffic type and its importance within an
organization's infrastructure. QoS ensures uniform and efficient traffic handling, keeping the most important traffic
moving at an acceptable speed, regardless of current bandwidth usage. It also provides methods for
administrators to control the priority settings of inbound traffic arriving at each network device.
End-to-end QoS behavior
The QoS settings on each network device must be aligned to achieve the desired end-to-end QoS behavior for a
network. Three service types can be used to categorize and prioritize network traffic:

• Best Effort Service
• Ethernet Class of Service (CoS)
•

Internet Differentiated Services (DiffServ)

For a network as a whole, it is best to select one service type to use as the primary end-to-end behavior, and then
use the other two service types as needed.

Best effort service
This is the simplest service type. All traffic is treated equally in a first-come, first-served manner. If the traffic load
is low in relation to the capacity of the network links, then there is no need for the administrative complexity and
costs of maintaining a more complex end-to-end policy. This is sometimes called over-provisioning, as all link
speeds are much higher than peak loads on the network.

Class of Service
Class of Service (CoS) is a method for classifying network traffic at layer 2 by marking 802.1Q VLAN Ethernet
frames with one of eight service classes.

CoS
7
6
5
4
3
2
0
1

Traffic type
Network Control
Internetwork Control
Voice (<10ms latency)
Video (<100ms latency)
Critical Applications
Excellent Effort
Best Effort
Background

Example protocols
STP, PVST
BGP, OSPF, PIM
VoIP(UDP)
RTP
SQL RPC, SNMP
NFS, SMB
HTTP, TELNET
SMTP, IMAP

CoS 1 is deliberately set as the lowest CoS. This enables a traffic service level below the default (best effort)
traffic level to be specified.
The 3-bit Priority Code Point (PCP) field within the 16-bit Ethernet VLAN tag is used to mark the CoS.

Chapter 1 QoS overview

5

 
 +--------+--------+--------+----------+-----------+--------
 | mac-da | mac-sa | 0x8100 | VLAN tag | ethertype | data...
 +--------+--------+--------+----------+-----------+--------
                           /            \
                          /              \
                         /                \
                      +-----+-----+---------+
                      | pcp | dei | vlan_id |
                      +-----+-----+---------+

Differentiated services
Differentiated services (DiffServ) is a method for classifying network traffic at layer 3 by marking packets with one
of 64 different service classes. Services classes are identified by the Differentiated services Code Point (DSCP)
value. Some common DSCP values are:

DSCP
56
46
40
34, 36, 38
32
26, 28, 30
24
18, 20, 22
16
00
10, 12, 14
08

Name
CS6
EF
CS5
AF41, AF42, AF43
CS4
AF31, AF32, AF33
CS3
AF21, AF22, AF23
CS2
CS0,BE,DF
AF11, AF12, AF13
CS1

Service class
Network Control
Telephony
Signaling
Multimedia Conferencing
Real-Time Interactive
Multimedia Streaming
Broadcast Video
Low-Latency Data
OAM
Best Effort
Bulk Data
Low-Priority Data

RFC
2474
3246
2474
2597
2474
2597
2474
2597
2474
2474
2597
3662

DSCP CS1 (08) CoS 1 is deliberately set as the lowest priority. This is enables a traffic service level below the
standard (best effort or default forwarding) level to be specified.
The DSCP value is carried within the IPv4 DSCP field or the upper 6-bits of the 8-bit IPv6 Traffic Class (TC) field.

+-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
IPv4   | ver | dscp | ecn | len | id | offset | ttl | proto | chksum | ip-sa | ip-da | data
       +-----+------+-----+-----+----+--------+-----+-------+--------+-------|-------+-----
             
          +------+-----+
          | dscp | ecn |
          +------+-----+
           \         /
            \       /
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----
 IPv6  | ver | tc  | len | label | next_header | hop_limit | ip-sa | ip-da | data
       +-----+-----+-----+-------+-------------+-----------+-------+-------+-----

6

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

QoS on the switch
There are five key stages a packet passes through when traversing a switch: ingress, prioritization, destination
determination, egress queuing, and transmission. The following table provides an overview of each stage, and
lists the commands that can be used to configure QoS settings.

The following diagram shows how two different packets (one using CoS, and one using DSCP) might traverse a
switch. It also shows how QoS configuration settings apply at each stage.

Chapter 1 QoS overview

7

QoS trust
Traffic priorities for networks can be carried in VLAN tags, using the CoS Priority Code Point (PCP), or in IP
packet headers, using the Differentiated Services Code Point (DSCP). Whether these priorities affect how traffic is
serviced depends upon which QoS trust mode is configured on the switch.
QoS trust mode specifies how the switch assigns local priority values to ingress packets. By default, the global
trust mode for the switch is trust none. This means that any QoS information in the packet (CoS or DSCP) is
ignored. When trust mode is set to CoS or DSCP, the switch translates the QoS settings in VLAN tags (for CoS),
or the DS field in an IP header (for DSCP), to local priority values on the switch. Translation is controlled by the
CoS map or DSCP map tables. For example:

8

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Trust mode can be set globally for all interfaces, or individually for each interface. By default, trust mode is set to
none, which means that local priority values are taken from the CoS map value for code point 0.

CoS map
The CoS map defines how the QoS settings for an ingress packet are mapped to the local priority settings on the
switch. The default settings for the CoS map are compliant with 802.1Q. To view the default settings, use the
command show cos-map default. For example:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

Ethernet 802.1Q and 802.1D CoS
IEEE 802.1Q is the most current Ethernet standard for class of service. It superseded an earlier standard,
802.1D, in 2005. IEEE 802.1Q slightly changed the ordering of the classes of service from its predecessor IEEE
802.1D for CoS 2 and CoS 0:

Chapter 1 QoS overview

9

CoS 802.1Q
7 Network Control
6 Internetwork Control
5 Voice (<10ms latency)
4 Video (<100ms latency)
3 Critical Applications
2 Excellent Effort
0 Best Effort
1 Background

CoS 802.1D
7 Network Control
6 Voice (<10ms latency)
5 Video (<100ms latency)
4 Controlled Load
3 Excellent Effort
0 Best Effort
2 Spare
1 Background

Note that in 802.1D, both CoS 2 and CoS 1 are below CoS 0 (Best Effort).
To configure support for 802.1D, edit the default CoS map settings for CoS 0 and 2. For example:
switch# config
switch(config)# qos cos-map 0 local-priority 2 color green name Best_Effort
switch(config)# qos cos-map 2 local-priority 1 color green name Spare
switch(config)# quit
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Best_Effort
1          0              green   Background
2          1              green   Spare
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

DSCP map
The DSCP map defines how the layer 3 QoS settings for an ingress packet are mapped to the local priority
settings used on the switch. To view the default settings for the DSCP map, use the command show dscp-map
default. For example:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green

10

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

62         7              green
63         7              green
(Color is reserved for future use.)
Queue profile
A queue profile defines the queues that are associated with an interface to control the transmission of packets.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling. Packets are assigned to a queue based on their local priority value.
A queue profile must be configured on every interface at all times.
The switch is automatically provisioned with an initial queue profile named default, which assigns each local
priority to the queue of the same number. This will work in most situations. Use the command show qos
queue-profile default to view the product default queue profile. Do not use show running-
configuration as it will only display changes from the initial values.
The following diagram shows the commands that are used to configure a queue profile.

Schedule profiles
A schedule profile determines the order in which queues are selected for transmission, and the amount of service
available for each queue. A schedule profile must be configured on every interface at all times. A schedule profile
can be applied globally to all interfaces, or only to specific interfaces.
Three options are available:

• All queues use weighted fair queuing (WFQ)
• All queues use strict priority queuing
• The highest priority queue uses strict priority, and all other queues use WFQ

A weighted schedule profile assigns relative servicing for each queue. The amount of service per weight is
relative to the underlying hardware implementation, and to the weights assigned to the other queues. Strict
scheduling can be used to service queues purely on the basis of highest priority first (at the risk of starving lower-
priority queues during high stress periods). A combination of strict and weighted scheduling offers more service to
the highest priority queue when needed, while preserving scheduling between the remaining queues, thus
decreasing the risk of starvation.
The switch is automatically provisioned with a schedule profile named factory-default, which assigns WFQ
to all queues with a weight of 1. Use the command show schedule-profile factory-default to view the
default schedule profile. (Do not use show running-configuration, as it only displays changes from the
initial settings.)

Chapter 1 QoS overview

11

switch# show qos queue-profile default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
Strict priority queuing
Strict priority (SP) is the simplest scheduling algorithm. For each round, the scheduler chooses the highest priority
(numbered) queue when transmitting packets. Effectively, it will always empty all packets from the highest priority
queue before any other lower priority queue.
While this does provide prioritization of traffic, spikes of high priority traffic will prevent lower priority traffic from
being transmitted (queue starvation).

Weighted fair queuing
Weighted fair queuing (WFQ) can limit queue starvation by providing a fairer distribution of available bandwidth
across priorities. Lower priority queues have some service even when packets are present in higher priority
queues. The degree to which this occurs depends on the weights assigned to each queue.
Each queue is assigned a weight that determines its proportion of overall queue service in a given servicing
window. The larger the weight, the greater the potential amount of service. Weights are used to compute a "virtual
finish time" for the queue data to finish transmission. For a servicing window, the queue with the shortest virtual
finishing time is selected to transmit next, and then new calculations are applied to the remaining data.
Because the "virtual finish time" calculation includes packet length, the WFQ algorithm accommodates variable
traffic and services each packet as close to fair as is possible.

Strict priority plus weighted fair queuing
SP plus WFQ is a hybrid of two algorithms, and is primarily used in networks carrying voice traffic. Queuing delay
and jitter (variance in delay) can readily affect the quality of a voice call. To prevent these conditions, voice traffic
should be in the highest priority queue, but this risks creating queue starvation for the traffic in other queues.
Using WFQ for all queues would be fairer to lower priority traffic, but at the risk of increased voice traffic delay and
jitter.
SP plus WFQ solves both problems. The highest priority queue is scheduled using strict priority, while the
remaining seven lower priority queues use WFQ.
On each round, the scheduler first checks the highest priority queue. When it has a packet ready, that packet is
selected for immediate transmission. When the highest priority queue is empty, the scheduler uses WFQ to select
the next packet for transmission from the remaining lower priority queues.
Port rate limiting
Port rate limiting helps control undesirable traffic. Its purpose is to allow enough broadcast, multicast, and
unknown-unicast traffic for the network to function properly, while preventing flooding and traffic storms.
A certain amount of each type of traffic is required for normal network operation. Broadcast packets may include
ARP and DHCP traffic, for instance. Video streams, and certain types of network protocol packets, are multicasts.
Unknown-unicast packets may be intended for devices whose addresses have temporarily aged out of network-
forwarding caches. Configuring rate limits can help provide the balance between necessary and flooded traffic.

12

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Virtual output queues
The switch uses a virtual output queue (VOQ) architecture where most packet buffering occurs on the ingress line
module. Traffic destined for one port (unicast), uses different buffering and scheduling than traffic destined for
multiple ports (flood). The relative priority and the amount of packet transmission for these two types of traffic
differ.
For unicast traffic, each line module contains eight VOQs for every destination port in the chassis (one per local
priority). The queue profile determines which VOQ is used to buffer a local priority. The schedule profile
determines the order of VOQ servicing. Unicast packets wait in VOQs until the scheduler selects them to cross
the fabric. Each destination port has a shallow egress transmit queue that buffers unicast packets.
Broadcast, multicast, and unknown-unicast packets, collectively called flooded traffic, use a separate path to the
destination ports. Each line module contains eight VOQs per destination line module (including itself) to buffer
traffic to be flooded (one VOQ per local priority). A copy of the packet to be flooded is buffered in VOQs for each
destination line module. The queue profile determines which VOQ is used for each local priority.
Flooded traffic VOQs use a fixed strict schedule profile to determine the order of VOQ servicing. Flooded packets
wait in VOQs until the scheduler selects them to cross the fabric. On the destination line module, they are
replicated to one or more destination ports. Each destination port has a second shallow egress queue for
replicated packets buffered for transmit.
A WFQ scheduler is used to select packets for transmission from the unicast and replicated traffic egress queues.
When selecting packets between two non-empty queues, WFQ uses a fixed data weight of four for unicast traffic,
and a weight of one for replicated traffic. As long as both queues are non-empty, replicated (flooded) packets
comprise approximately 20% of the transmitted traffic, independent of the unicast scheduled percentages.
Terms
Class

For networking, a set of packets sharing a common characteristic. For example, all IPv4 packets.

Code point

The name of a packet header field, or the name of the values carried within a packet header field:
Example 1: Priority code point (PCP) is the name of a field in the IEEE 802.1Q VLAN tag.
Example 2: Differentiated services code point (DSCP) is the name of values carried within the DS field of an
IP packet header.

Class of service (CoS)

A 3-bit value used to mark packets with one of eight classes (levels of priority). It is carried within the priority
code point (PCP) field of the IEEE 802.1Q VLAN tag.

Differentiated services code point (DSCP)

A 6-bit value used to mark packets for different per-hop behavior as originally defined by IETF RFC 2474. It is
carried within the differentiated services (DS) field of the IPv4 or IPv6 header.

Local priority

A meta-data label associated with a packet within a network switch. It is used by the switch to distinguish
packets for different treatment (such as queue assignment).

Metadata

Information labels associated with each packet in the switch, separate from the packet headers and data.
These labels are used by the switch in its handling of the packet. For example: arrival port, egress port, VLAN
membership, and local priority.

Chapter 1 QoS overview

13

Priority code point (PCP)

The name of a 3-bit field in the IEEE 802.1Q VLAN tag. It carries the CoS value to mark a packet with one of
eight classes (priority levels).

Quality of service (QoS)

General term used when describing or measuring performance. For networking, it means how different
classes of packets are treated when traversing a network or device.

Traffic class (TC)

General term for a set of packets sharing a common characteristic. It used to be the name of an 8-bit field in
the IPv6 header originally defined by IETF RFC 2460. This field name was changed to differentiated services
by IETF RFC 2474.
Type of service (ToS)

General term when there are different levels of treatment (fare class). It used to be the name of an 8-bit field
in the IPv4 header originally defined by IETF RFC 791. This field name was changed to differentiated services
by IETF RFC 2474.

14

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 2
QoS configuration

Configuring QoS
Procedure
1. Configure how local priority values are assigned to ingress packets with the commands qos cos-map, qos

dscp-map, and qos trust.
If you do not want to use the default QoS profile to define priority values for ingress traffic, create one or more
custom queue profiles with the command qos queue-profile. For each queue in a custom queue profile:
a. Define a priority value with the command map queue.
b. Optionally, define a descriptive name with the command name queue.

2.

3.

If you do not want to use the default QoS schedule profile to determine the order in which queues are selected
to transmit a packet, create one or more custom schedule profiles with the command qos schedule-
profile. For each queue in a custom schedule queue profile, define scheduling priority with the commands 
strict queue and wfq queue.

4. Activate QoS settings with the command apply qos. This command lets you apply a queue profile and

schedule profile globally to all interfaces, or individually to specific interfaces.

5. Optionally, add a rate limit for ingress traffic on one or more interfaces with the command rate-limit.
6. View QoS configuration settings with the commands show interface, show qos cos-map, show qos

dscp-map, show qos queue-profile, qos schedule-profile, and show qos trust.

Examples
This example creates the following configuration:

• Configures CoS to be used to assign local priority to ingress packets.
• Modifies the default CoS map to assign CoS 1 to local priority 1.
• Creates a queue profile named Q1.
• Assigns local priority 1 to queue 2.
• Creates a schedule profile named S1.
• Assigns WFQ with weight 17 to queue 2.
• Applies Q1 and S1 to interface 1/1/1 and 1/1/2.

switch(config)# qos trust cos
switch(config)# qos cos-map 1 local-priority 1
switch(config)# qos queue-profile Q1
switch(config)# map queue 2 local-priority 1
switch(config)# qos schedule-profile S1
switch(config)# wfq queue 2 weight 17

Chapter 2 QoS configuration

15

switch(config)# interface 1/1/1
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1
switch(config-if)# interface 1/1/2
switch(config-if)# apply qos queue-profile Q1 schedule-profile S1 
Configuring expedited forwarding for VoIP traffic
Voice over IP (VoIP) traffic is delay and jitter sensitive. Therefore, for optimum transmission of VoIP traffic, dwell
time in network devices must be kept to a minimum, and all network devices in the datapath must have identical
per-hop behaviors. To configure a dedicated queue on the switch to handle VoIP traffic with priority service before
all other queues, follow these steps.

Prerequisites
This scenario assumes that VoIP packets are uniquely identified using Differs code point 46, Expedited
Forwarding (EF).

Procedure

1. Map DSCP EF packets exclusively to local priority 5. The default DSCP map has eight code points (40 through
47), that are mapped to local priority 5. To reserve local priority 5 for VoIP traffic, the other code points must be
reassigned. In this scenario, local priority 6 is used for all reassignments, including for code point 40, Call
Signaling protocol (CS5).
switch# config
switch(config)# qos dscp-map 40 local-priority 6 name CS5
switch(config)# qos dscp-map 41 local-priority 6
switch(config)# qos dscp-map 42 local-priority 6 
switch(config)# qos dscp-map 43 local-priority 6 
switch(config)# qos dscp-map 44 local-priority 6 
switch(config)# qos dscp-map 45 local-priority 6 
switch(config)# qos dscp-map 47 local-priority 6 

2. Queue 7 is the highest priority queue, so for best throughput, create a queue profile that maps local priority 5

to queue 7.
switch(config)# qos queue-profile ef_priority
switch(config-queue)# name queue 7 Voice_Priority_Queue
switch(config-queue)# map queue 7 local-priority 5
switch(config-queue)# map queue 6 local-priority 7
switch(config-queue)# map queue 5 local-priority 6
switch(config-queue)# map queue 4 local-priority 4
switch(config-queue)# map queue 3 local-priority 3
switch(config-queue)# map queue 2 local-priority 2
switch(config-queue)# map queue 1 local-priority 1
switch(config-queue)# map queue 0 local-priority 0
switch(config-queue)# exit
switch(config)#

3. Create a schedule profile that services queue 7 using strict priority (SP), and the remaining queues with WFQ.

This scenario gives all WFQ queues equal weight.
switch(config)# qos schedule-profile voip
switch(config-schedule)# strict queue 7
switch(config-schedule)# wfq queue 6 weight 1
switch(config-schedule)# wfq queue 5 weight 1
switch(config-schedule)# wfq queue 4 weight 1
switch(config-schedule)# wfq queue 3 weight 1
switch(config-schedule)# wfq queue 2 weight 1
switch(config-schedule)# wfq queue 1 weight 1

16

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-schedule)# wfq queue 0 weight 1
switch(config-schedule)# exit
switch(config)#

4. Apply the profiles to all interfaces.

switch(config)# apply qos queue-profile ef_priority schedule-profile voip

5. Configure DSCP trust mode to all ports
switch(config)# qos trust dscp

Configuring rate limiting
This scenario illustrates how to use rate limiting to manage the traffic from various devices connected to a switch.
The physical topology of the network looks like this:

A certain amount of broadcast traffic is necessary to maintain healthy network operation, particularly from routers
and across service boundaries. In this scenario, both the service cloud and the router connections limit this traffic
to 1 Gbps. The server has a smaller limit, as it does not require as much network protocol traffic as the service
cloud and router.
A multicast server needs to be able to stream multicast traffic to clients, so a multicast rate limit may not be
helpful. A computer, however, should not be generating large amounts of multicast traffic (it may be receiving
streams, but typically not sending them). In this example, the computer is configured with a multicast rate limit to
prevent malicious traffic from taking up network bandwidth.
Finally, while the service cloud and router may need to send traffic for unknown unicast addresses to resolve
address forwarding, the server and computer should send very little of this type of traffic. Rate limiting unknown
unicast traffic on those two devices enforces that.

Procedure

1. Configure broadcast and multicast rate limiting for the service cloud connection.

switch# config
switch(config)# interface 1/1/1
switch(config-if)# rate-limit broadcast 1000000 kbps
switch(config-if)# rate-limit multicast 2000000 kbps

2. Configure broadcast rate limiting for the router connection.

switch(config-if)# interface 1/1/2
switch(config-if)# rate-limit broadcast 1000000 kbps

Chapter 2 QoS configuration

17

3. Configure broadcast and unknown unicast rate limiting for the server connection.

switch(config-if)# interface 1/1/5
switch(config-if)# rate-limit broadcast 500000 kbps
switch(config-if)# rate-limit unknown-unicast 500 kbps

4. Configure broadcast, multicast, and unknown unicast rate limiting for the computer connection.

switch(config-if)# interface 1/1/10
switch(config-if)# rate-limit broadcast 1000 kbps
switch(config-if)# rate-limit multicast 500 kbps
switch(config-if)# rate-limit unknown-unicast 200 kbps

Monitoring queue operation
Use the show interface command to display the number of packets and bytes queued for transmission. For
example:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392
 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before it was sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

18

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 3
QoS commands

apply qos

Syntax
apply qos [queue-profile <QUEUE-NAME>] schedule-profile <SCHEDULE-NAME>
no apply qos schedule-profile <SCHEDULE-NAME>

Description
Applies a queue profile and schedule profile globally to all Ethernet and LAG interfaces on the switch, or applies
only a schedule profile to a specific interface. When applied globally, the specified schedule profile is configured
only on Ethernet interfaces and LAGs that do not already have their own schedule profile.
In the config-if context, the no form of this command removes the specified schedule profile from an interface
and the interface uses the global schedule profile. This is the only way to remove a schedule profile override from
the interface.
In the config context, the no apply qos command reverts the global queue and schedule profiles back to
their factory-default values. It is not necessary to specify the currently applied queue and schedule profile names.

Interfaces may shut down briefly during reconfiguration.

Command context
config
config-if

Parameters
<QUEUE-NAME>

Specifies the name of the queue profile to apply. Specify up to 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-). This parameter is not supported in the config-if context.

schedule-profile <SCHEDULE-NAME>

Specifies the name of the schedule profile to apply. Specify up to 64 alphanumeric characters, including
period (.), underscore (_), and hyphen (-).

Authority
Administrators

Usage

• For a queue profile to be complete and ready to be applied, all local priorities must be mapped to a queue.
• For a schedule profile to be complete and ready to be applied, all eight queues must be defined. All queues

must use the same algorithm, except for the highest numbered queue, which may be strict.

Chapter 3 QoS commands

19

• Both the queue profile and the schedule profile must specify the same number of queues.
• An applied profile can only be updated or deleted when it is not applied to an interface.

Example
Applying the QoS profile myprofile and the schedule profile myschedule to all interfaces that do not have an
applied profile:
switch(config)# apply qos queue-profile myprofile schedule-profile myschedule 
name queue

Syntax
name queue  <QUEUE-NUMBER> <DESCRIPTION>
no name queue  <QUEUE-NUMBER>

Description
Assigns a description to a queue in a queue profile. This is for identification purposes and has no effect on
configuration.
The no form of this command removes the description associated with a queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the queue number of the queue. Range: 0 to 7.

<DESCRIPTION>

Specifies a description for the queue. Range: 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

Authority
Administrators

Examples
Assigning the description priority to queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# name queue 7 priority
Removing the description priority from queue 7:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no name queue 7 priority

20

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

map queue

Syntax
map queue <QUEUE-NUMBER> local-priority <PRIORITY-NUMBER>
no map queue <QUEUE-NUMBER> [local-priority <PRIORITY-NUMBER>]

Description
Defines the local priority for a queue in a queue profile. By default, the larger the queue number the higher its
priority. Only one local priority value can be assigned to each queue. A queue without any local priorities assigned
is not used to store packets.
Before a queue can be applied, all local priorities must be assigned to a queue.
The no form of this command removes the local priority from a specific queue.

Command context
config-queue

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

<PRIORITY-NUMBER>

Specifies a priority number for the queue. Range: 0 to 7, where 0 is the lowest priority and 7 is the highest.

Authority
Administrators

Examples
Assigning the priority 7 to queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# map queue 7 local-priority 7
Removing the priority 7 from queue 7 in profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# no map queue 7 local-priority 7
qos cos-map

Syntax
qos cos-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos cos-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific 802.1 VLAN priority code point (CoS) value.
The CoS map values are used to mark incoming packets when QoS trust mode is set to cos.
To see the default CoS map settings, use the following command:

Chapter 3 QoS commands

21

switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
The no form of this command restores the assignments for a CoS map value to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an 802.1 VLAN priority CoS value. Range: 0 to 7. Default 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the CoS setting. The name is for identification only, and has no effect on queue
configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen (-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Mapping CoS value 1 to a local priority of 2:
switch(config)# qos cos-map 1 local-priority 2 
Mapping CoS value 1 to the default local priority value:
switch(config)# no qos cos-map 1 
qos dscp-map

Syntax
qos dscp-map <CODE-POINT> local-priority <PRIORITY-NUMBER> [color <COLOR>] [name <DESCRIPTION>]
no qos dscp-map <CODE-POINT>

Description
Defines the local priority assigned to incoming packets for a specific IP differentiated services code point (DSCP)
value. The DSCP map values are used to prioritize incoming packets when QoS trust mode is set to dscp.

22

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

To see the default DSCP map settings, use the following command:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
The no form of this command restores the assignments for a code point to the default setting.

Command context
config

Parameters
<CODE-POINT>

Specifies an IP differentiated services code point. Range: 0 to 63. Default: 0.

local-priority <PRIORITY-NUMBER>

Specifies a local priority value to associate with the CODE-POINT value. Range: 0 to 7. Default: 0.

color <COLOR>

Reserved for future use.

name <DESCRIPTION>

Specifies a description for the DSCP setting. The name is used for identification only, and has no effect on
queue configuration. Range: 1 - 64 alphanumeric characters, including period (.), underscore (_), and hyphen
(-).

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Setting code point 1 to a local priority of 2:
switch(config)# qos dscp-map 1 local-priority 2 
Setting code point 1 to the default value:
switch(config)# no qos dscp-map 1 

Chapter 3 QoS commands

23

qos queue-profile

Syntax
qos queue-profile <NAME>
no qos queue-profile <NAME>

Description
Creates a new QoS queue profile and switches to the config-queue context for the profile. If the specified QoS
queue profile exists, this command switches to the config-queue context for the profile. A queue profile
determines the priority with which queues are selected when transmitting packets on an interface.
A profile named factory-default is defined by default and is automatically applied. It cannot be edited or
deleted. Use the command show qos queue-profile factory-default to view this profile. Do not use
show running-configuration, as it will only display changes from the initial values.
Each profile has eight queues, numbered 0 to 7. The larger the queue number, the higher its priority during
transmission scheduling.
The no form of this command removes the specified QoS profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS queue profile to create or configure. Range: 64 alphanumeric characters,
including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the profile myprofile:
switch(config)# qos queue-profile myprofile
switch(config-queue)# 
Deleting the profile myprofile:
switch(config)# no qos queue-profile myprofile
qos schedule-profile

Syntax
qos schedule-profile <NAME>
no qos schedule-profile <NAME>

Description
Creates a QoS schedule profile and switches to the config-schedule context for the profile. If the specified
schedule profile exists, this command switches to the config-schedule context for the profile. The schedule

24

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

profile determines the order in which queues are selected to transmit a packet, and the amount of service defined
for each queue.
Queues in a schedule profile are numbered consecutively starting from zero. Queue zero is the lowest priority
queue. The larger the queue number, the higher priority the queue has in scheduling algorithms.
A profile named factory-default is defined by default and applied to all interfaces. It cannot be edited or
deleted. To see its settings, use the command:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1
4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1
A profile named strict is predefined and cannot be edited or deleted. The strict profile services all queues of
the queue profile to which it is applied, using the strict priority algorithm.
A schedule profile must be defined on all interfaces at all times.
There are two permitted configurations for a schedule profile:

1. All queues use the same scheduling algorithm (for example, DWRR).
2. The highest queue number uses strict priority, and all remaining (lower) queues use the same algorithm (for
example, DWRR). This supports priority scheduling behavior necessary for the IEFT RFC 3246 Expedited
Forwarding specification (https://tools.ietf.org/html/rfc3246).

An applied schedule profile cannot be edited or deleted.
The no form of this command removes the specified QoS schedule profile when it is not applied.

Command context
config

Parameters
<NAME>

Specifies the name of the QoS schedule profile to create or configure. Range: 1 - 64 alphanumeric
characters, including period (.), underscore (_), and hyphen (-).

Authority
Administrators

Examples
Creating the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# 
Deleting the schedule profile myschedule:
switch(config)# no qos schedule-profile myschedule

Chapter 3 QoS commands

25

qos trust

Syntax
qos trust {none | cos | dscp}
no qos trust

Description
Sets the trust mode. Trust mode determines whether CoS or DSCP values are used to assign local priority values
to ingress packets. CoS values are taken from the CoS map, and DSCP values are taken from the DSCP map.
In the config context:

• This command sets the trust mode that is globally applied to all interfaces that do not have a trust mode

configured.

• The no form of this command restores all interfaces that do not currently have a trust mode configured to the

default setting (none).

In the config-if context:

• This command sets the trust mode override for a specific interface.
• The no form of this command clears a trust mode override. The interface then uses the global setting. This is

the only way to remove a trust mode override.

Command context
config
config-if

Parameters
none

Ignore all packet headers. Ingress packets are assigned the priority value configured for CoS map value 0.
Default.

cos

For 802.1 VLAN-tagged packets, use the priority code point field value from the outermost VLAN header as
the index into the CoS map. If the packet is untagged, use the priority configured for CoS map value 0.

dscp

For IP packets, use the DSCP value as the index into the DSCP map. For non-IP packets, use the priority
configured for CoS map value 0

Authority
Administrators

Example
Setting the global trust mode to dscp, which is applied to all interfaces that do not already have an individual trust
mode configured. An override is then applied to interface 2/2/2, and LAG 100, setting trust mode to cos:
switch(config)# qos trust dscp
switch(config)# interface 2/2/2

26

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

switch(config-if)# qos trust cos
switch(config-if)# interface lag 100
switch(config-if)# qos trust cos
rate-limit

Syntax
rate-limit {broadcast | multicast | unknown-unicast} <RATE> {kbps | pps}
no rate-limit {broadcast | multicast | unknown-unicast}

Description
Sets the amount of traffic of a specific type that can ingress on an Ethernet port, or on each port of a LAG
interface. Rate limits are enforced separately on each individual member of a LAG, not on the LAG as a whole.
The no form of this command removes the traffic limit for the specified traffic type.

Command context
config-if

Parameters
{broadcast | multicast | unknown-unicast}

Specifies the type of ingress traffic to which the rate limit applies: broadcast, multicast, or unknown-
unicast.

<RATE> {kbps | pps}

Specifies the rate limit. Range: 22 - 100000000 kbps (in steps of 22 kbps), or 43 - 209090910 kbps (in steps
of 43 pps).

Authority
Administrators

Examples
Limiting broadcast traffic to 500 kbps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit broadcast 500 kbps
Limiting multicast traffic to 4000 pps on interface 3:
switch(config)# interface 1/1/3
switch(config-if)# rate-limit multicast 4000 pps
Limiting unknown unicast traffic to 100 kbps on interface 1/1/3.
switch(config)# interface 1/1/3
switch(config-if)# rate-limit unknown-unicast 100 kbps
Viewing the results of the previous configuration settings.
switch# show interface 1/1/3
Interface 1/1/3 is down (Administratively down)
 Admin state is down
 Hardware: Ethernet, MAC Address: 1c:98:ec:e3:6a:00
 MTU 1500

Chapter 3 QoS commands

27

 Full-duplex
 rate-limit broadcast unknown-unicast 100 kbps (109 actual)
 rate-limit broadcast 500 kbps (505 actual)
 rate-limit multicast 4000 pps (3990 actual)
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
 RX
            0 input packets              0 bytes
            0 input error                0 dropped
            0 CRC/FCS
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
 TX
            0 output packets             0 bytes
            0 input error                0 dropped
            0 collision
       L3:
            ucast: 0 packets, 0 bytes
            mcast: 0 packets, 0 bytes
Limiting broadcast traffic to 50 kbps on LAG 100.
switch# config
switch(config)# interface 1/1/1
switch(config)# interface lag 100
switch(config-if)# rate-limit broadcast 50 kbps
switch(config)# interface 1/1/2
switch(config-if)# lag 100
switch(config)# interface 1/1/3
switch(config-if)# lag 100
show interface

Syntax
show interface <INTERFACE-NAME> [queues]

Description
Shows interface-level configuration, including any QoS settings that may override the global settings on the
switch.

For every layer 3 packet transmitted on a switch queue, an extra three bytes are added to the value
of Tx Bytes (due to the inclusion of an internal routing packet header). To show layer 3 statistics
without this addition, enable layer 3 counters on an interface, and execute the command show
interface. For example:
switch(config)# interface 1/1/1
switch(config-if)# l3-counters
switch(config-if)# quit
switch# show interface 1/1/1

Command context
Manager (#)

28

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<INTERFACE-NAME>

Specifies the name of an interface on the switch. Some switches (such as the Aruba 8400 Switch Series), use
the format member/slot/port (for example, 1/1/1). Other switches use slot/port (for example, 1/1).

queues

Show queue statistics.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Usage
Statistics include:

• Tx Bytes: Total bytes transmitted. The byte count may include packet headers and internal metadata that are
removed before the packet is transmitted. Packet headers added when the packet is transmitted may not be
included.

• Tx Packets: Total packets transmitted.
• Tx Errors: Shows the amount of traffic dropped on an egress interface before being sent. When traffic cannot

be forwarded out an egress interface, it backs up on ingress. The more servicing assigned to a queue by a
schedule profile, the less likely traffic destined for that queue will back up and be dropped. Tx Errors shows the
sum of packets that were dropped across all line modules (due to insufficient capacity) by the ingress Virtual
Output Queues (VOQs) destined for the egress port. As the counts are read separately from each line module,
the sum is not an instantaneous snapshot.

• Tx Byte Depth: Largest byte depth (or high watermark) found on any ingress line module Virtual Output Queue

(VOQ) destined for the egress port.

Examples
Showing settings for interface 1/1/5:
switch# show interface 5
Interface 5 is down (Administratively down)
 Admin state is down
 State information: admin_down
 Hardware: Ethernet, MAC Address: aa:55:aa:55:00:29
 MTU 1500
 Full-duplex
 qos trust cos
 qos schedule-profile default
 qos dscp override 46
 Speed 0 Mb/s
 Auto-Negotiation is turned on
 Input flow-control is off, output flow-control is off
Showing queue statistics for interface 1/1/5:
switch# show interface 1/1/5 queues
Interface 1/1/5 is up
 Admin state is up
               Tx Bytes      Tx Packets       Tx Errors         Tx Byte Depth
 Q0        157113373520      1890863919               0                  1362
 Q1        233312143017      2808451320              18                 65550
 Q2        156814056423      1887257650               0                  1392

Chapter 3 QoS commands

29

 Q3        157441358980      1894815504               0                  1374
 Q4        157700809294      1897941370               0                  1362
 Q5        157872849381      1900014146               0                  1392
 Q6        183486049854      2208268429               0                  4398
 Q7        231607534141      2787913734               0                 65544

show qos cos-map

Syntax
show qos cos-map [default]

Description
Shows the global QoS CoS code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default CoS code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current CoS map:
switch# show qos cos-map
code_point local_priority color   name
---------- -------------- ------- ----
0          2              green   Bulk
1          0              green   Scavenger
2          1              green   Best_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
Showing the default CoS map:
switch# show qos cos-map default
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   Best_Effort
1          0              green   Background
2          2              green   Excellent_Effort
3          3              green   Critical_Applications
4          4              green   Video
5          5              green   Voice
6          6              green   Internetwork_Control
7          7              green   Network_Control
(Color is reserved for future use.)

30

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

show qos dscp-map

Syntax
show qos dscp-map [default]

Description
Shows the global QoS DSCP code point settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default DSCP code point settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current DSCP map:
switch# show qos dscp-map
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green
5          1              green
6          1              green
7          1              green
8          0              green   CS1
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         7              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
Showing the default DSCP map:
switch# show qos dscp-map default
code_point local_priority color   name
---------- -------------- ------- ----
code_point local_priority color   name
---------- -------------- ------- ----
0          1              green   CS0
1          1              green
2          1              green
3          1              green
4          1              green

Chapter 3 QoS commands

31

5          1              green
 <--OUTPUT OMITTED FOR BREVITY-->
45         5              green
46         5              green   EF
47         5              green
48         6              green   CS6
 <--OUTPUT OMITTED FOR BREVITY-->
61         7              green
62         7              green
63         7              green
(Color is reserved for future use.)

show qos queue-profile

Syntax
show qos queue-profile [<NAME> | factory-default ]

Description
Shows the status of all queue profiles, or a specific queue profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue profile. Range 1 - 64 alphanumeric characters, including period (.), underscore
(_), and hyphen (-).

factory-default

Specifies the default profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of queue profile myprofile:
switch# show qos queue-profile myprofile
queue_num local_priorities name
--------- ---------------- ----
0         2                Normal_and_Bulk
1         0                Other
2         1                Best_Effort
3         3
4         4
5         5
6         6
7         7                High_Priority
Showing the status of the default queue profile factory-default:
switch# show qos queue-profile factory-default
queue_num local_priorities name
--------- ---------------- ----

32

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

0         0                Scavenger_and_backup_data
1         1
2         2
3         3
4         4
5         5
6         6
7         7

show qos schedule-profile

Syntax
show qos schedule-profile [<NAME> | factory-default]

Description
Shows the status of all schedule profiles, or a specific schedule profile.

Command context
Manager (#)

Parameters
<NAME>

Specifies the name of a queue or schedule profile. Range: 1 - 64 alphanumeric characters, including period
(.), underscore (_), and hyphen (-).

factory-default

Specifies the default schedule profile.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Example
Showing the status of schedule profile myschedule:
switch# show qos schedule-profile myschedule
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       2
2         wfq       3
3         wfq       4
4         wfq       5
5         wfq       6
6         wfq       7
7         wfq       8
Showing the status of the default schedule profile:
switch# show qos schedule-profile factory-default
queue_num algorithm weight
--------- --------- ------
0         wfq       1
1         wfq       1
2         wfq       1
3         wfq       1

Chapter 3 QoS commands

33

4         wfq       1
5         wfq       1
6         wfq       1
7         wfq       1

show qos trust

Syntax
show qos trust [default]

Description
Shows the global QoS trust settings, or the factory default settings.

Command context
Manager (#)

Parameters
default

Shows the factory default QoS trust settings.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Showing the current QoS trust settings:
switch# show qos trust
qos trust cos
Showing the default QoS trust settings:
switch# show qos trust default
qos trust none
strict queue

Syntax
strict queue <QUEUE-NUMBER>
no strict queue <QUEUE-NUMBER>

Description
Assigns the strict priority algorithm to a queue. Strict priority services all packets waiting in a queue, before
servicing the packets in lower priority queues. Strict priority can only be applied to the highest priority queue in a
schedule profile.
The no form of this command removes the strict priority algorithm from a queue.

Command context
config-schedule

34

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning strict priority to queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# strict queue 7
Deleting strict priority from queue 7 in the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no strict queue 7
wfq queue

Syntax
wfq queue <QUEUE-NUMBER> weight <WEIGHT>
no wfq queue <QUEUE-NUMBER> [<WEIGHT>]

Description
Assigns the weighted fair queuing (WFQ) algorithm and its weight to a queue. Weighted fair queuing allocates
available bandwidth among all queues that are not empty, in relation to their queue weights. WFQ is applied in
bytes, not packets. It is work conserving, which means that only non-empty queues are counted on each
scheduling cycle. The percentage of bandwidth allotted to a non-empty queue is calculated by dividing its weight
by the sum of the weights for all non-empty queues. This means that the percentage of bandwidth allotted to a
queue can fluctuate, depending on the number of non-empty queues present in each cycle.
The no form of this command removes the weighted fair queuing algorithm from a queue.

Command context
config-schedule

Parameters
<QUEUE-NUMBER>

Specifies the number of the queue. Range: 0 to 7.

weight <WEIGHT>

Specifies the weight to use for scheduling. Range: 1 to 253.

Authority
Operators or Administrators. Users without administrator authority can execute this command from the operator
context (>) only.

Examples
Assigning WFQ with a weight of 17 to queue 2 in the schedule profile myschedule:

Chapter 3 QoS commands

35

switch(config)# qos schedule-profile myschedule
switch(config-schedule)# wfq queue 2 weight 17
Deleting WFQ for queue 2 from the schedule profile myschedule:
switch(config)# qos schedule-profile myschedule
switch(config-schedule)# no wfq queue 2 

36

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

Chapter 4
Websites

Networking Websites
Hewlett Packard Enterprise Networking Information Library

www.hpe.com/networking/resourcefinder

Hewlett Packard Enterprise Networking Software

www.hpe.com/networking/software

Hewlett Packard Enterprise Networking website

www.hpe.com/info/networking

Hewlett Packard Enterprise My Networking website

www.hpe.com/networking/support

Hewlett Packard Enterprise My Networking Portal

www.hpe.com/networking/mynetworking

Hewlett Packard Enterprise Networking Warranty

www.hpe.com/networking/warranty

General websites
Hewlett Packard Enterprise Information Library

www.hpe.com/info/EIL

For additional websites, see Support and other resources.

Chapter 4 Websites

37

Chapter 5
Support and other resources

Accessing Hewlett Packard Enterprise Support
• For live assistance, go to the Contact Hewlett Packard Enterprise Worldwide website:

http://www.hpe.com/assistance

• To access documentation and support services, go to the Hewlett Packard Enterprise Support Center website:

http://www.hpe.com/support/hpesc

Information to collect

• Technical support registration number (if applicable)
• Product name, model or version, and serial number
• Operating system name and version
• Firmware version
• Error messages
• Product-specific reports and logs
• Add-on products or components
• Third-party products or components

Accessing updates
• Some software products provide a mechanism for accessing software updates through the product interface.

Review your product documentation to identify the recommended software update method.

• To download product updates:

Hewlett Packard Enterprise Support Center

www.hpe.com/support/hpesc

Hewlett Packard Enterprise Support Center: Software downloads

www.hpe.com/support/downloads

Software Depot

www.hpe.com/support/softwaredepot

• To subscribe to eNewsletters and alerts:

www.hpe.com/support/e-updates

• To view and update your entitlements, and to link your contracts and warranties with your profile, go to the

Hewlett Packard Enterprise Support Center More Information on Access to Support Materials page:

38

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00

www.hpe.com/support/AccessToSupportMaterials

Access to some updates might require product entitlement when accessed through the Hewlett
Packard Enterprise Support Center. You must have an HPE Passport set up with relevant
entitlements.

Customer self repair
Hewlett Packard Enterprise customer self repair (CSR) programs allow you to repair your product. If a CSR part
needs to be replaced, it will be shipped directly to you so that you can install it at your convenience. Some parts
do not qualify for CSR. Your Hewlett Packard Enterprise authorized service provider will determine whether a
repair can be accomplished by CSR.
For more information about CSR, contact your local service provider or go to the CSR website:
http://www.hpe.com/support/selfrepair
Remote support
Remote support is available with supported devices as part of your warranty or contractual support agreement. It
provides intelligent event diagnosis, and automatic, secure submission of hardware event notifications to Hewlett
Packard Enterprise, which will initiate a fast and accurate resolution based on your product's service level.
Hewlett Packard Enterprise strongly recommends that you register your device for remote support.
If your product includes additional remote support details, use search to locate that information.

Remote support and Proactive Care information
HPE Get Connected

www.hpe.com/services/getconnected

HPE Proactive Care services

www.hpe.com/services/proactivecare

HPE Proactive Care service: Supported products list

www.hpe.com/services/proactivecaresupportedproducts

HPE Proactive Care advanced service: Supported products list

www.hpe.com/services/proactivecareadvancedsupportedproducts

Proactive Care customer information
Proactive Care central

www.hpe.com/services/proactivecarecentral

Proactive Care service activation

www.hpe.com/services/proactivecarecentralgetstarted

Warranty information
To view the warranty for your product or to view the Safety and Compliance Information for Server, Storage,
Power, Networking, and Rack Products reference document, go to the Enterprise Safety and Compliance website:
www.hpe.com/support/Safety-Compliance-EnterpriseProducts

Additional warranty information
HPE ProLiant and x86 Servers and Options

www.hpe.com/support/ProLiantServers-Warranties

Chapter 5 Support and other resources

39

HPE Enterprise Servers

www.hpe.com/support/EnterpriseServers-Warranties

HPE Storage Products

www.hpe.com/support/Storage-Warranties

HPE Networking Products

www.hpe.com/support/Networking-Warranties

Regulatory information
To view the regulatory information for your product, view the Safety and Compliance Information for Server,
Storage, Power, Networking, and Rack Products, available at the Hewlett Packard Enterprise Support Center:
www.hpe.com/support/Safety-Compliance-EnterpriseProducts

Additional regulatory information
Hewlett Packard Enterprise is committed to providing our customers with information about the chemical
substances in our products as needed to comply with legal requirements such as REACH (Regulation EC No
1907/2006 of the European Parliament and the Council). A chemical information report for this product can be
found at:
www.hpe.com/info/reach
For Hewlett Packard Enterprise product environmental and safety information and compliance data, including
RoHS and REACH, see:
www.hpe.com/info/ecodata
For Hewlett Packard Enterprise environmental information, including company programs, product recycling, and
energy efficiency, see:
www.hpe.com/info/environment
Documentation feedback
Hewlett Packard Enterprise is committed to providing documentation that meets your needs. To help us improve
the documentation, send any errors, suggestions, or comments to Documentation Feedback
(docsfeedback@hpe.com). When submitting your feedback, include the document title, part number, edition,
and publication date located on the front cover of the document. For online help content, include the product
name, product version, help edition, and publication date located on the legal notices page.

40

Aruba 8400 Quality of Service Guide for ArubaOS-CX 10.00


